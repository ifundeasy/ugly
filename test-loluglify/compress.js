function justcopy(e,s){fs.createReadStream(e).pipe(fs.createWriteStream(s))}function minifying(e,s,t){var r,n;switch(e){case"css":var i=void 0;r=ugly.css,n=r.processFiles([s],i||{});break;case"js":r=ugly.js,n=r.minify(s).code}console.log(e,t),fs.appendFile(t,n,function(e){e&&console.log(e)})}function readdir(e,s){fs.readdir(e,function(s,t){s?console.log(s):t.forEach(function(s){var t=e+s;if(-1==exceptions.indexOf(t)){var r=isDir(t),n=t.replace(baseIn,baseOut);r?(mkdir(n),readdir(r)):fs.unlink(n,function(){var e=n.substr(n.lastIndexOf("/")+1,n.length-1),s="",r=e.lastIndexOf(".");0!=r&&-1!==r?(s=e.substr(r+1,e.length-1).toLowerCase(),-1!==exts.indexOf(s)?minifying(s,t,n):justcopy(t,n)):justcopy(t,n)})}})})}var fs=require("fs"),path=require("path"),ugly={js:require("uglify-js"),css:require("uglifycss")},baseOut,baseIn=path.normalize(process.argv[2]),force=process.argv[3]||!1,exceptions,exts=Object.keys(ugly).map(function(e){return e.toString().toLowerCase()}),mkdir=function(e){try{return e&&"/"!=e.indexOf(e.length-1)&&(e+="/"),fs.mkdirSync(e),e}catch(s){}},isDir=function(e){var s=fs.lstatSync(e).isDirectory();return s&&(s=e,"/"!==e[e.length-1]&&(s+="/")),s};if(baseIn=isDir(baseIn)){var okay=!1;baseOut=baseIn.substr(0,baseIn.length-1)+"-loluglify";try{fs.lstatSync(baseOut)&&"true"==force&&(okay=!0)}catch(e){mkdir(baseOut),okay=!0}if(okay){baseOut=isDir(baseOut);var e=fs.readFileSync(baseIn+".loluglify").toString()||"[]";exceptions=JSON.parse(e).map(function(e){var s=e;return"/*"==s.substr(s.length-2,2)&&(s=s.substr(0,s.length-2)),"/"==s.substr(s.length-1,1)&&(s=s.substr(0,s.length-1)),console.log("execption :",baseIn+s),baseIn+s}),readdir(baseIn,baseOut)}else console.log("Output directory is exist!")}else console.log("Invalid input directory!");